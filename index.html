<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bilal | hiveoptic archive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
            color: #ffffff;
            margin: 0;
            -webkit-font-smoothing: antialiased;
        }
        
        .tracking-ultra { letter-spacing: 0.6em; }
        
        ::-webkit-scrollbar { width: 2px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; }

        nav {
            background-color: #000000;
            border-bottom: 1px solid #111;
        }

        .project-card {
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1;
        }

        .project-card:hover {
            transform: scale(1.3);
            z-index: 50;
            box-shadow: 0 10px 40px rgba(0,0,0,0.9);
        }

        .project-card img {
            transition: filter 0.5s ease;
        }

        .project-card:hover img {
            filter: grayscale(0%) brightness(1.2);
        }

        .project-overlay {
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .project-card:hover .project-overlay {
            opacity: 1;
        }

        .modal-active {
            animation: modalFadeIn 0.4s ease forwards;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; backdrop-filter: blur(0px); }
            to { opacity: 1; backdrop-filter: blur(25px); }
        }
    </style>
</head>
<body class="pt-24 md:pt-32 p-2 md:p-6">

    <nav class="fixed top-0 left-0 w-full z-[100] p-4 md:p-8 flex justify-between items-center">
        <div>
            <h1 class="text-base font-light lowercase tracking-ultra">bilal</h1>
            <p class="text-[8px] uppercase tracking-widest text-zinc-600 mt-0.5">hiveoptic archive</p>
        </div>
        <div class="text-right flex items-center gap-8">
            <div class="hidden sm:block">
                <p class="text-[9px] uppercase tracking-widest text-zinc-600 mb-0.5">vault status</p>
                <span id="status-tag" class="text-[10px] text-zinc-400 uppercase tracking-widest transition-colors duration-500">offline mode</span>
            </div>
            <div>
                <p class="text-[9px] uppercase tracking-widest text-zinc-600 mb-0.5">total entries</p>
                <span id="project-counter" class="text-xl font-light">000</span>
            </div>
        </div>
    </nav>

    <main class="w-full mx-auto px-1">
        <div id="portfolio-grid" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 xl:grid-cols-12 gap-1">
            <!-- Content injected via JS -->
        </div>
    </main>

    <footer class="mt-32 mb-12 text-center border-t border-zinc-900 pt-12">
        <a href="mailto:bilal@hiveoptic.com" class="text-[10px] lowercase tracking-widest text-zinc-500 hover:text-white transition-colors">bilal@hiveoptic.com</a>
        <p class="text-[8px] uppercase tracking-[0.8em] text-zinc-800 mt-4">Â© hiveoptic</p>
    </footer>

    <div id="video-modal" class="fixed inset-0 z-[200] hidden flex items-center justify-center p-4 bg-black/90">
        <button onclick="closeModal()" class="absolute top-6 right-6 text-white hover:text-zinc-400 transition-colors z-[210]">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M18 6L6 18M6 6l12 12"/></svg>
        </button>
        <div class="w-full max-w-6xl aspect-video bg-black shadow-2xl relative">
            <div id="video-container" class="w-full h-full"></div>
        </div>
    </div>

    <script>
    const PROJECT_ID = "gi6q4yr8"; 
    const DATASET = "production";

    async function initArchive() {
        const grid = document.getElementById('portfolio-grid');
        const counter = document.getElementById('project-counter');
        const status = document.getElementById('status-tag');
        
        console.log("Attempting to connect to Sanity...");

        if (!PROJECT_ID || PROJECT_ID === "PASTE_YOUR_ID_HERE") {
            status.innerText = "ID MISSING";
            return;
        }

        const QUERY = encodeURIComponent('*[_type == "project"] | order(order asc)');
        const API_URL = `https://${PROJECT_ID}.api.sanity.io/v2021-10-21/data/query/${DATASET}?query=${QUERY}`;
        
        try {
            const response = await fetch(API_URL);
            
            if (!response.ok) {
                const error_text = await response.text(); 
                console.error("Sanity API Error:", error_text);
                status.innerText = "API ERROR";
                return;
            }

            const { result } = await response.json();
            console.log("Sanity data received:", result);
            
            if (!result || result.length === 0) {
                status.innerText = "NO DATA FOUND";
                status.className = "text-[10px] text-yellow-500 uppercase tracking-widest";
                return;
            }

            grid.innerHTML = '';
            counter.innerText = result.length.toString().padStart(3, '0');

            result.forEach(p => {
                let thumbUrl = "";
                let videoUrl = p.videoUrl || "";
                let embedUrl = "";

                // Handle Thumbnail Logic
                if (p.thumbnail && p.thumbnail.asset) {
                    thumbUrl = `https://cdn.sanity.io/images/${PROJECT_ID}/${DATASET}/${p.thumbnail.asset._ref.replace('image-', '').replace('-jpg', '.jpg').replace('-png', '.png').replace('-webp', '.webp')}?w=600&h=600&fit=crop`;
                } else {
                    if (videoUrl.includes('youtube.com') || videoUrl.includes('youtu.be')) {
                        const ytId = videoUrl.split('v=')[1]?.split('&')[0] || videoUrl.split('/').pop();
                        thumbUrl = `https://img.youtube.com/vi/${ytId}/maxresdefault.jpg`;
                        embedUrl = `https://www.youtube.com/embed/${ytId}`;
                    } else if (videoUrl.includes('vimeo.com')) {
                        const vimeoId = videoUrl.split('/').pop();
                        thumbUrl = `https://vumbnail.com/${vimeoId}.jpg`;
                        embedUrl = `https://player.vimeo.com/video/${vimeoId}`;
                    }
                }

                const div = document.createElement('div');
                div.className = "project-card relative aspect-square cursor-pointer bg-zinc-950 overflow-hidden";
                div.onclick = () => openModal(embedUrl || videoUrl);
                
                div.innerHTML = `
                    <img src="${thumbUrl}" alt="${p.title}" loading="lazy" 
                         onerror="this.src='https://picsum.photos/seed/${p._id}/400/400'"
                         class="w-full h-full object-cover grayscale brightness-50">
                    <div class="project-overlay absolute inset-0 flex flex-col justify-end p-1.5 pointer-events-none">
                        <h3 class="text-[7px] font-light lowercase truncate opacity-80 text-white">${p.title || 'Untitled'}</h3>
                    </div>
                `;
                grid.appendChild(div);
            });

            // Connection successful
            status.innerText = "Synchronized";
            status.className = "text-[10px] text-green-500 uppercase tracking-widest";

        } catch (e) {
            console.error("Critical Connection Error:", e);
            status.innerText = "CONNECTION FAILED";
        }
    }

    function openModal(videoUrl) {
        if (!videoUrl) return;
        const modal = document.getElementById('video-modal');
        const container = document.getElementById('video-container');
        
        modal.classList.remove('hidden');
        modal.classList.add('modal-active');
        
        // Ensure autoplay and correct embed params
        let finalUrl = videoUrl;
        if (finalUrl.includes('?')) {
            finalUrl += "&autoplay=1";
        } else {
            finalUrl += "?autoplay=1";
        }

        container.innerHTML = `<iframe src="${finalUrl}" class="w-full h-full" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>`;
        document.body.style.overflow = 'hidden';
    }

    function closeModal() {
        const modal = document.getElementById('video-modal');
        modal.classList.add('hidden');
        modal.classList.remove('modal-active');
        document.getElementById('video-container').innerHTML = '';
        document.body.style.overflow = 'auto';
    }

    window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });
    window.onload = initArchive;
</script>
</body>
</html>
